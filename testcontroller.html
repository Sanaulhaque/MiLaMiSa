<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<style>
		.container {
			position: relative;
		}

		.right {
			position: absolute;
			right: 16px;

		}
		.left {
			position: absolute;
			left: 16px;
		}
		.bottomright {
    position: absolute;
    bottom: 8px;
    right: 16px;
    font-size: 18px;
}


		</style>
		<script type="text/javascript" src="http://spaceify.net/games/g/gamelib.min.js"></script>
		
		<script type="text/javascript">	
				
		//Group name for development use
				
		var GROUP_NAME = "lars";
				
		var SERVER_ADDRESS = {host: "spaceify.net", port: 1979};
		var WEBRTC_CONFIG = {"iceServers":[{url:"stun:kandela.tv"},{url :"turn:kandela.tv", username:"webrtcuser", credential:"jeejeejee"}]};
			
		function TestController()
			{
			var self = this;
			
			var gameClient = null;
			
			self.connect = function()
				{
				gameClient = new GameClient(); 
				gameClient.setScreenConnectionTypeListener(self, self.onScreenConnectionTypeUpdated);
				
				//Development connection
				gameClient.connect(SERVER_ADDRESS.host, SERVER_ADDRESS.port, "controller", GROUP_NAME, function(){});
				
				//Production connection
				//gameClient.connectAsController(function(){});	
				};
			
			self.sendButtonPress = function(direction)
				{
				console.log("TestController::sendButtonPress()");
				gameClient.notifyScreens("onButtonPressed",[direction]);
				};
				
			self.onScreenConnectionTypeUpdated = function(newConnectionType, screenId)
				{
				console.log("TestController::onScreenConnectionTypeUpdated() new connection type: " + newConnectionType);
				document.getElementById("conntype").innerHTML = newConnectionType;
				};
			}
		
		var controller = null; 
			
		window.onload = function()
			{
			controller = new TestController();
			controller.connect();
			}
				
		</script>
		<title>
			Controller
		</title>
	</head>
<body>

	<h2>
		Controller MiLaMiSa 
	</h2>
	<p>
		Task: Collect a cup of coffee!
	</p>
	    <div class="left"><canvas id="cCanvas" width="200" height="200"></canvas></div>
		<div class="right"><canvas id="bCanvas" width="300" height="200" style="border:1px solid #000000;"></canvas></div>
    <script>
	  var bCanvas = document.getElementById('bCanvas');
      var bcontext = bCanvas.getContext('2d');
	  var imageObj = new Image();

      imageObj.onload = function() {
        bcontext.drawImage(imageObj, 250, 40, 40, 40);
      };
      imageObj.src = 'http://192.168.1.203/1465925339_si-duo-t-shirt.png';
	  
	  bcontext.font = "20px Arial";
	  bcontext.fillText("Collected Items:",150,20);
	  bcontext.closePath();
      bcontext.lineWidth = 5;
      bcontext.fillStyle = 'red';
      //context.fill();
      bcontext.strokeStyle = '#550000';
      bcontext.stroke();
	  
	  var startx = 100;
	  var starty = 100
      var cCanvas = document.getElementById('cCanvas');
      var context = cCanvas.getContext('2d');

	  
      //context.beginPath();
      context.arc(startx, starty, 70, (Math.PI / 180) * 45, (Math.PI / 180) * 135, false);
	  context.moveTo(startx, starty);
	  context.lineTo(startx+50,starty+50);
	  context.moveTo(startx, starty);
	  context.lineTo(startx-50,starty+50);
	  
	  
	  context.arc(startx, starty, 70, (Math.PI / 180) * 135, (Math.PI / 180) * 225, false);
	  context.moveTo(startx, starty);
	  context.lineTo(startx-50,starty-50);
	  context.moveTo(startx, starty);

	  
	  context.arc(startx, starty, 70, (Math.PI / 180) * 225, (Math.PI / 180) * 315, false);
	  context.moveTo(startx, starty);
	  context.lineTo(startx-50,starty-50);
	  context.moveTo(startx, starty);
	  
	  
	  context.arc(startx, starty, 70, (Math.PI / 180) * 315, (Math.PI / 180) * 405, false);
	  context.moveTo(startx, starty);
	  context.lineTo(startx-50,starty-50);
	  context.moveTo(startx, starty);

	  
      context.closePath();
      context.lineWidth = 5;
      context.fillStyle = 'red';
      //context.fill();
      context.strokeStyle = '#550000';
      context.stroke();
	  console.log("message");
	        function getMousePos(canvas, evt) {
        var rect = canvas.getBoundingClientRect();
        return {
          x: evt.clientX - rect.left,
          y: evt.clientY - rect.top
        };
      }
	  cCanvas.addEventListener('click', function(evt) {
        var mousePos = getMousePos(cCanvas, evt);
		if(mousePos.x<70 && mousePos.y > 50 && mousePos.y < 150){
			console.log("Left");
			controller.sendButtonPress("left");
		}
		if(mousePos.x > 110 && mousePos.y > 50 && mousePos.y < 150){
			console.log("Right");
			controller.sendButtonPress("right");
		}
		if(mousePos.x > 75 && mousePos.y < 100 && mousePos.x < 120){
			controller.sendButtonPress("top");
			console.log("Top");
		}
		if(mousePos.x > 75 && mousePos.y > 100 && mousePos.x < 120){
			controller.sendButtonPress("down");
			console.log("Down");
		}
        var message = 'Mouse position: ' + mousePos.x + ',' + mousePos.y;
        console.log(message);
      }, false);

    </script>
	<!--
	<div class=bottomright><h3>Connectiontype to the screen:</h3><h3 id="conntype">Cloud</h3>
	<button onclick="controller.sendButtonPress("TEST");">Send button press to Server</button></div></div>-->
</body>
</html>